import turtle
import random
import time
import pygame

# --- Инициализация звука ---
pygame.init()
pygame.mixer.init()

# Фоновая музыка
pygame.mixer.music.load("background_music.mp3")  # Замените на путь к вашей музыке
pygame.mixer.music.play(-1)  # Зацикливаем

# Звук нажатия кнопки
click_sound = pygame.mixer.Sound("click.wav")  # Замените на путь к вашему звуку

# Окно
screen = turtle.Screen()
screen.title("Космическая классификация")
screen.bgcolor("black")
screen.setup(width=800, height=600)

# Игрок и очки
score = 0
mistakes = 0

# Словарь объектов
space_objects = {
    "Метеор": "Вспышка света в атмосфере, когда метеороид сгорает.",
    "Метеорит": "Остаток метеороидa, долетевший до Земли.",
    "Астероид": "Каменистое тело, вращающееся вокруг Солнца.",
    "Комета": "Ледяное тело с хвостом при приближении к Солнцу."
}

# Факты
facts = {
    "Метеор": [
        "Метеоры сгорают в атмосфере и не достигают Земли.",
        "Метеоры часто называют 'падающими звёздами'."
    ],
    "Метеорит": [
        "Метеориты могут быть каменными или железными.",
        "Самый тяжёлый метеорит — Гоба, 60 тонн."
    ],
    "Астероид": [
        "У астероидов могут быть свои спутники.",
        "Астероиды обитают в поясе между Марсом и Юпитером."
    ],
    "Комета": [
        "Хвост кометы всегда указывает от Солнца.",
        "Комета Галлея появляется каждые 76 лет."
    ]
}

# Turtle для текста
text_writer = turtle.Turtle()
text_writer.hideturtle()
text_writer.color("white")
text_writer.penup()
text_writer.goto(0, 220)

# Turtle для объекта
object_writer = turtle.Turtle()
object_writer.hideturtle()
object_writer.color("cyan")
object_writer.penup()
object_writer.goto(0, 50)

# Текущий объект
current_object = ""

# Функция показа нового объекта
def show_object():
    global current_object
    object_writer.clear()
    current_object = random.choice(list(space_objects.keys()))
    object_writer.write(f"Что это?", align="center", font=("Arial", 24, "bold"))
    time.sleep(1)
    object_writer.clear()
    object_writer.write(current_object, align="center", font=("Arial", 36, "bold"))

# Функция проверки ответа
def check_answer(answer):
    global score, mistakes
    click_sound.play()
    text_writer.clear()
    if answer == current_object:
        score += 1
        fact = random.choice(facts[answer])
        text_writer.write(f"Верно! {fact}", align="center", font=("Arial", 16, "normal"))
    else:
        mistakes += 1
        text_writer.write(f"Неверно. Это был {current_object}. {space_objects[current_object]}", align="center", font=("Arial", 16, "normal"))
    if score >= 10:
        end_game("Победа! Ты стал Аспирантом Галактической Науки!")
    elif mistakes >= 3:
        end_game("Слишком много ошибок. Попробуй снова.")
    else:
        screen.ontimer(show_object, 2000)

# Конец игры
def end_game(message):
    object_writer.clear()
    object_writer.goto(0, 0)
    object_writer.write(message, align="center", font=("Arial", 24, "bold"))
    pygame.mixer.music.stop()
    screen.bye()

# Кнопки
buttons = ["Метеор", "Метеорит", "Астероид", "Комета"]
button_turtles = []
label_turtles = []

def create_buttons():
    for i, name in enumerate(buttons):
        # Фон кнопки
        t = turtle.Turtle()
        t.shape("square")
        t.shapesize(stretch_wid=2, stretch_len=7)
        t.color("navy")
        t.penup()
        x = -300 + i*200
        t.goto(x, -200)

        # Текст кнопки
        label = turtle.Turtle()
        label.hideturtle()
        label.color("white")
        label.penup()
        label.goto(x, -190)
        label.write(name, align="center", font=("Arial", 12, "bold"))

        def make_callback(ans=name):
            return lambda x, y: check_answer(ans)

        t.onclick(make_callback())
        button_turtles.append(t)
        label_turtles.append(label)

# Начальный экран
def start_game():
    text_writer.goto(0, 250)
    text_writer.write("Добро пожаловать, студент!", align="center", font=("Arial", 20, "bold"))
    time.sleep(2)
    text_writer.clear()
    create_buttons()
    show_object()
